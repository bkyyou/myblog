(window.webpackJsonp=window.webpackJsonp||[]).push([[218],{788:function(n,t,e){"use strict";e.r(t);var s=e(29),a=Object(s.a)({},(function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("h1",{attrs:{id:"_4-如何调适和阅读webpack源码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-如何调适和阅读webpack源码"}},[n._v("#")]),n._v(" 4.如何调适和阅读webpack源码")]),n._v(" "),e("p",[n._v("webpack-cli/bin/cli.js  这是一切打包的入口")]),n._v(" "),e("p",[n._v("npx webpack  是如何工作的")]),n._v(" "),e("p",[n._v("是找到 node_modules/.bin/webpack")]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("echo %~dp0  输出当前的路径\npuash 暂停\n")])])]),e("p",[n._v("compiler  全局只有一个\ncompilation  代表一次编译\n继承 tapable 可以订阅和发射事件")]),n._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[n._v("compiler"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[n._v("run")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[n._v("err"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" stats")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[n._v("=>")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[n._v("// stats 输入内容信息")]),n._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n")])])]),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[n._v("// SingleEntryPlugin ")]),n._v("\ncompiler"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),n._v("hooks"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),n._v("make"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[n._v("tapAsync")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[n._v("'SingleEntryPlugin'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[n._v("compiler"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" callback")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[n._v("=>")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("const")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v(" entry"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" context "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[n._v("=")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("const")]),n._v(" dep "),e("span",{pre:!0,attrs:{class:"token operator"}},[n._v("=")]),n._v(" SingleEntryPlugin"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[n._v("createDependency")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("entry"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n    compilation"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[n._v("addEntry")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" dep"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" callback"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n")])])]),n._v(" "),e("h2",{attrs:{id:"webpack执行流程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#webpack执行流程"}},[n._v("#")]),n._v(" webpack执行流程")]),n._v(" "),e("h3",{attrs:{id:"compiler"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#compiler"}},[n._v("#")]),n._v(" compiler")]),n._v(" "),e("p",[n._v("environment   设置node环境变量\nafterEnvironment  设置环境变量完成\nentryOption   解析入口文件\nafterPlugins  挂在插件结束， 在 webpack.config.js 上会挂载很多的插件\nafterResolvers   在路径解析器初始化后触发， 核心作用是给他路径，就能找到绝对路径\ninitialize\nbeforeRun  开始编译前\nrun        开始编译\nnormalModuleFactory   创建普通模块工厂\ncontextModuleFactory  创建上下文模块工厂\nbeforeCompile   开始编译前\ncompile   编译\nthisCompilation   开始启动编译\ncompilation  开始创建 compilation\nmake    最核心代码，是从入口文件开始编译\nfinishMake"),e("br"),n._v("\nafterCompile  编译完成\nshouldEmit  询问是否要生成文件\nemit  生成文件\n（assetEmitted 资源已经生成 已经不存在了）\nafterEmit  生成完成\ndone  编译结束\nafterDone")]),n._v(" "),e("h3",{attrs:{id:"compilation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#compilation"}},[n._v("#")]),n._v(" Compilation")]),n._v(" "),e("p",[n._v("buildModule  编译入口模块  2\nrebuildModule\nfailedModule\nsucceedModule   成功加载模块  4\nstillValidModule\naddEntry   添加入口 ./src/index.js  1\nfailedEntry   入口解析失败   5\nsucceedEntry   入口解析成功   5\ndependencyReferencedExports\nfinishModules    完成模块编译   6\nfinishRebuildingModule\nunseal\nseal   封装，一旦封装完成，不再向内添加新的模块   7\nbeforeChunks\nafterChunks\noptimizeDependencies    优化依赖项\nafterOptimizeDependencies\noptimize\noptimizeModules  优化 modules\nafterOptimizeModules\noptimizeChunks  优化 chunks\nafterOptimizeChunks\noptimizeTree\nafterOptimizeTree\noptimizeChunkModules  优化 chunks module\nafterOptimizeChunkModules\nshouldRecord   是否要记录  stats文件\nadditionalChunkRuntimeRequirements\nruntimeRequirementInChunk\nadditionalModuleRuntimeRequirements\nruntimeRequirementInModule\nadditionalTreeRuntimeRequirements\nruntimeRequirementInTree\nruntimeModule\nreviveModules\nbeforeModuleIds"),e("br"),n._v("\nmoduleIds\noptimizeModuleIds\nafterOptimizeModuleIds\nreviveChunks\nbeforeChunkIds\nchunkIds\noptimizeChunkIds\nafterOptimizeChunkIds\nrecordModules 记录模块\nrecordChunks  记录 chunk\noptimizeCodeGeneration\nbeforeModuleHash\nafterModuleHash\nbeforeCodeGeneration\nafterCodeGeneration\nbeforeRuntimeRequirements\nafterRuntimeRequirements\nbeforeHash   生成 hash 前\ncontentHash  生成内容hash\nafterHash\nrecordHash\nrecord\nbeforeModuleAssets\nshouldGenerateChunkAssets\nbeforeChunkAssets\nadditionalChunkAssets\nadditionalAssets\noptimizeChunkAssets\nafterOptimizeChunkAssets\noptimizeAssets\nafterOptimizeAssets\nprocessAssets\nafterProcessAssets\nprocessAdditionalAssets\nneedAdditionalSeal\nafterSeal\nrenderManifest\nfullHash\nchunkHash\nmoduleAsset\nchunkAsset\nassetPath\nneedAdditionalPass\nchildCompiler\nlog\nprocessWarnings\nprocessErrors\nstatsPreset\nstatsNormalize\nstatsFactory\nstatsPrinter\nnormalModuleLoader  拿到正常的模块加载器  3")]),n._v(" "),e("h2",{attrs:{id:"_5-stats"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-stats"}},[n._v("#")]),n._v(" 5.stats")]),n._v(" "),e("p",[n._v("npx webpack --profile --json > stats.json")]),n._v(" "),e("h2",{attrs:{id:"module"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#module"}},[n._v("#")]),n._v(" module")]),n._v(" "),e("p",[n._v("会根据依赖关系生成 chunk")]),n._v(" "),e("ol",[e("li",[n._v("每个入口文件天然就是一个 chunk， 此入口文件和依赖的模块生成一个 chunk")]),n._v(" "),e("li",[n._v("如果说某个模块里有动态引入语句 import 语句，就会由 import 单独生成一个新的代码块，这个代码块放置着动态引入的模块，以及动态引入的模块引入的模块")]),n._v(" "),e("li",[n._v("splitchunks 实现同步代码分割，把多个代码块公共的模块提供一个单独的代码块；还可以把某些模块， 比如 node_modules 里的模块单独提出来成立一个代码块")])])])}),[],!1,null,null,null);t.default=a.exports}}]);